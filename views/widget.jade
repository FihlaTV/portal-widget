- var using_auth_server = request.query.authUrl
- var using_basic_auth = request.query.basic_auth == 1

script(src=docroot+"/javascripts/widget.min.js")

if using_auth_server
  script(src=request.query.authUrl)

script.
  var supported = voxbone.WebRTC.isWebRTCSupported();
  function makeCall(){
    VoxWidget.makeCall({ 'callerId': !{"callerId" in request.query ? JSON.stringify(request.query.callerId) : "myScope.callerId"}, 'dial_pad': !{"dialPad" in request.query ? JSON.stringify(request.query.dialPad) : "JSON.stringify(myScope.dial_pad)"}, 'context': !{"context" in request.query ? JSON.stringify(request.query.context) : "myScope.context"}, 'send_digits': !{"sendDigits" in request.query ? JSON.stringify(request.query.sendDigits) : "myScope.send_digits"}, 'ibc': !{"incompatibleBrowserConfiguration" in request.query ? JSON.stringify(request.query.incompatibleBrowserConfiguration)  : "myScope.incompatible_browser_configuration"}, 'link_button_to_a_page_value': !{"linkButtonToAPageValue" in request.query ? JSON.stringify(request.query.linkButtonToAPageValue) : "myScope.link_button_to_a_page_value"}, 'number': !{JSON.stringify(request.query.e164)}, 'supported': !{"incompatibleBrowserConfiguration" in request.query ? "supported" : "myScope.preview_webrtc_compatible"}});
  };
  $(document).ready(function () {
    if(supported) {
      !{using_auth_server ? "voxbone.WebRTC.init(voxrtc_config)" : ""}
      !{!using_auth_server && using_basic_auth ? "var username = " + JSON.stringify(request.query.login) + ", secret = " + JSON.stringify(request.query.password) + ";": ""}
      !{!using_auth_server && using_basic_auth ? "voxbone.WebRTC.basicAuthInit(username, secret);" : ""}
      !{!using_auth_server && using_basic_auth ? "voxbone.WebRTC.customEventHandler.authExpired= function() { voxbone.WebRTC.basicAuthInit(username, secret);};" : ""}
    } else {
      !{request.query.incompatibleBrowserConfiguration == 'show_text_html' ? "$('#launch_call').hide();$('#not-supported-message').removeClass('hidden');":""}
      !{request.query.incompatibleBrowserConfiguration == 'hide_widget' ? "$('.widget-box').hide();":""}
    }
  });
.not-supported.hidden#not-supported-message
  | !{"showTextHtmlValue" in request.query ? request.query.showTextHtmlValue : "{{show_text_html_value}}"}
.widget-box(style="max-width: 400px" class="#{request.query.buttonStyle || '{{button_style}}'}")
  if "buttonText" in request.query
    button.btn-style#launch_call #[span #{request.query.buttonText}]
  else
    button.btn-style#launch_call #[span {{buttonText}}]
  div#control
    .widget-footer-right(class="#{request.query.buttonStyle || '{{button_style}}'}")
      a(href="http://www.voxbone.com" target="_blank") powered by:
